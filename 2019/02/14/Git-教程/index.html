<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Git 教程 |   Lilac的个人主页 </title>

 
  
    <link rel="icon" href="/images/favicon.png">
  


  <link rel="stylesheet" href="/nayo.min.css"> 
</head>  
  <body>   
    
      <header class="header">
	
  <nav class="header-nav">        
   
    <span class="iconfont icon-menu mobile-toggle"></span>   	

    <div class="header-menu">          
              
            

              <a class="header-menu-link" id="header-menu-home" href="/">首页</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-categories" href="/categories">分类</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-archives" href="/archives">归档</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-tags" href="/tags">标签</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-about" href="/about">关于</a>     

            
            
            

              <a class="iconfont icon-menu-search header-menu-link" id="header-menu-search"></a>

            
                
    </div>  
    
  </nav>
</header>   

      <div class="container">       
          
          
            <section class="main">  
          

          <article class="post">
  
	<div class="post-header">

	<p class="post-title">	
		Git 教程
	</p>
			

	<div class="meta-info">	
	<span>
		Feb 14, 2019
	</span>

	
	
		<i class="iconfont icon-words"></i>
		<span>
			9758
		</span>
	
</div>

</div> 
	 

	  <div class="post-content slideDownMin">

		

			
					<h3 id="一、Git介绍"><a href="#一、Git介绍" class="headerlink" title="一、Git介绍"></a>一、Git介绍</h3><p>Git是目前世界上最先进的分布式版本控制系统。</p>
<h4 id="1-1-集中式-VS-分布式"><a href="#1-1-集中式-VS-分布式" class="headerlink" title="1.1 集中式 VS 分布式"></a>1.1 集中式 VS 分布式</h4><p>CVS及SVN都是集中式的版本控制系统，而Git是分布式版本控制系统。</p>
<p><strong>集中式版本控制系统</strong>：版本库是集中存放在中央服务器，程序员首先需要从中央服务器获取最新版本，然后开始干活，干完活，再把自己的活推给中央服务器。</p>
<p><strong>分布式版本控制系统</strong>：没有“中央服务器”，每个人的电脑上都是一个完整的版本库，工作的时候不需要联网。</p>
<p>和集中式版本控制系统相比，分布式版本控制系统的安全性要高很多，因为每个人电脑里都有完整的版本库，而集中式版本控制系统的中央服务器要是出了问题，所有人都没法正常工作了。</p>
<h4 id="1-2-Git的安装"><a href="#1-2-Git的安装" class="headerlink" title="1.2 Git的安装"></a>1.2 Git的安装</h4><h5 id="1-2-1-Linux上安装Git"><a href="#1-2-1-Linux上安装Git" class="headerlink" title="1.2.1 Linux上安装Git"></a>1.2.1 Linux上安装Git</h5><p>如果是Debian或Ubuntu Linux，通过命令 sudo apt-get install git 可以直接完Git的安装。</p>
<p>如果是其他Linux版本，可以直接通过源码安装，先从Git官网下载源码，然后解压，一次键入：./config，make，sudo make install这几个命令安装即可。</p>
<h5 id="1-2-2-Windows上安装Git"><a href="#1-2-2-Windows上安装Git" class="headerlink" title="1.2.2 Windows上安装Git"></a>1.2.2 Windows上安装Git</h5><p>从Git官网直接下载安装程序，然后按默认选项安装即可。</p>
<p>安装完成后，需要最后一步设置，在命令行输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;Your Name&quot;</span><br><span class="line">$ git config --global user.email &quot;email@example.com&quot;</span><br></pre></td></tr></table></figure>
<p>git config 命令的 global 参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p>
<h4 id="1-3-创建版本库"><a href="#1-3-创建版本库" class="headerlink" title="1.3 创建版本库"></a>1.3 创建版本库</h4><p>版本库又名仓库，英文名<strong>repository</strong>，你可以简单理解成一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。</p>
<p><strong>第一步</strong>：选择一个合适的地方，创建一个目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir learngit</span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong>：通过 git init 命令把这个目录变成Git可以管理的仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br></pre></td></tr></table></figure>
<h4 id="1-4-把文件添加到版本库"><a href="#1-4-把文件添加到版本库" class="headerlink" title="1.4 把文件添加到版本库"></a>1.4 把文件添加到版本库</h4><p>我们在learngit目录或子目录下新建一个 readme.txt 文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Git is a version control system.</span><br><span class="line">Git is free software.</span><br></pre></td></tr></table></figure>
<p><strong>第一步</strong>：用命令 git add 告诉Git，把文件添加Git仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add readme.txt</span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong>：用命令 git commit 告诉Git，把文件提交到仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;wrote a readme file&quot;</span><br></pre></td></tr></table></figure>
<p>-m 后面的输入是本次提交的说明，可以输入任意内容，当然最好是有意义的，这样你就能从历史记录里方便地找到改动记录。</p>
<h3 id="二、时光机穿梭"><a href="#二、时光机穿梭" class="headerlink" title="二、时光机穿梭"></a>二、时光机穿梭</h3><p>上一章节我们成功地添加并提交了一个 readme.txt 文件，现在我们修改文件内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Git is a distributed version control system.</span><br><span class="line">Git is free software.</span><br></pre></td></tr></table></figure>
<p>现在，运行 <strong>git status</strong> 命令查看结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">        modified:   readme.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>
<p>git status 命令可以让我们时刻掌握仓库当前的状态，上面的命令输出告诉我们，readme.txt 被修改过了，但还没有准备提交的修改。</p>
<p>而通过 <strong>git diff</strong> 命令可以查看文件的修改内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/readme.txt b/readme.txt</span><br><span class="line">index d8036c1..013b5bc 100644</span><br><span class="line">--- a/readme.txt</span><br><span class="line">+++ b/readme.txt</span><br><span class="line">@@ -1,2 +1,2 @@</span><br><span class="line">-Git is a version control system.</span><br><span class="line">+Git is a distributed version control system.</span><br><span class="line"> Git is free software.</span><br><span class="line">\ No newline at end of file</span><br></pre></td></tr></table></figure>
<p>知道了对 readme.txt 作了什么修改后，再把它提交到仓库就放心多了，提交修改文件和提交新文件是一样的两步。 </p>
<h4 id="2-1-版本回退"><a href="#2-1-版本回退" class="headerlink" title="2.1 版本回退"></a>2.1 版本回退</h4><p>通过 <strong>git log</strong> 命令可以查看文件提交的历史记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git log</span><br><span class="line">commit 023ddd630b4bef98b7a71d21c9d2e28d28460d7a (HEAD -&gt; master)</span><br><span class="line">Author: lilacflower &lt;511811776@qq.com&gt;</span><br><span class="line">Date:   Tue Jan 22 11:24:41 2019 +0800</span><br><span class="line"></span><br><span class="line">    add distributed</span><br><span class="line"></span><br><span class="line">commit 00cb7386e7ce80b44e77a9f20c1ac5949f1f090e</span><br><span class="line">Author: lilacflower &lt;511811776@qq.com&gt;</span><br><span class="line">Date:   Tue Jan 22 11:15:34 2019 +0800</span><br><span class="line"></span><br><span class="line">    wrote a readme file</span><br></pre></td></tr></table></figure>
<p>现在我们把当前版本 add distributed 回退到上一个版本 wrote a readme file，可以使用 <strong>git reset</strong> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard HEAD^</span><br><span class="line">HEAD is now at 00cb738 wrote a readme file</span><br></pre></td></tr></table></figure>
<p>在 Git 中，用 <strong>HEAD</strong> 表示当前版本，上一个版本就是 <strong>HEAD^</strong>，上上一个版本就是<strong>HEAD^^</strong>，当然往上100个版本写100个 ^ 比较容易数不过来，所以写成 <strong>HEAD~100</strong>。 </p>
<h5 id="回退到指定的某个版本："><a href="#回退到指定的某个版本：" class="headerlink" title="回退到指定的某个版本："></a>回退到指定的某个版本：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 023ddd6</span><br><span class="line">HEAD is now at 023ddd6 add distributed</span><br></pre></td></tr></table></figure>
<p>其中 023ddd6 是指版本号，版本号没必要写全，前几位就可以了，Git会自动去找，当然也不能只写前一两位，因为Git可能会找到多个版本号，就无法确定是哪一个了。</p>
<p>如果忘记版本号，可以通过 <strong>git reflog</strong> 用来查看每一次命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br><span class="line">023ddd6 (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to 023ddd6</span><br><span class="line">00cb738 HEAD@&#123;1&#125;: reset: moving to HEAD^</span><br><span class="line">023ddd6 (HEAD -&gt; master) HEAD@&#123;2&#125;: commit: add distributed</span><br><span class="line">00cb738 HEAD@&#123;3&#125;: commit (initial): wrote a readme file</span><br></pre></td></tr></table></figure>
<h4 id="2-2-工作区和暂存区"><a href="#2-2-工作区和暂存区" class="headerlink" title="2.2 工作区和暂存区"></a>2.2 工作区和暂存区</h4><p><strong>工作区</strong>：之前创建的 learngit 文件夹就是一个工作区。</p>
<p><strong>暂存区</strong>：工作区有一个隐藏目录 .git ，这个不算工作区，而是 Git 的版本库。版本库里存放了很多东西，其中最重要的称为 <strong>stage</strong> （或者叫 index）的暂存区，还有 Git 为我们自己创建的第一个分支 master，以及指向 <strong>master</strong> 的一个指针 <strong>HEAD</strong>。</p>
<p>前面讲的把文件往版本库添加是分两步进行的，简单理解为，需要提交的文件修改通通放到暂存区，然后一次性提交暂存区的所有修改。</p>
<h4 id="2-3-管理修改"><a href="#2-3-管理修改" class="headerlink" title="2.3 管理修改"></a>2.3 管理修改</h4><p>Git跟踪和管理的是修改，而非文件，<strong>git add</strong> 是将修改放入暂存区，<strong>git commit</strong> 只负责将暂存区的修改提交。</p>
<h4 id="2-4-撤销修改"><a href="#2-4-撤销修改" class="headerlink" title="2.4 撤销修改"></a>2.4 撤销修改</h4><p><strong>场景1</strong>：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- file</span><br></pre></td></tr></table></figure>
<p><strong>场景2</strong>：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset HEAD file</span><br><span class="line">$ git checkout -- file</span><br></pre></td></tr></table></figure>
<p><strong>场景3</strong>：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退一节，不过前提是没有推送到远程库。</p>
<h4 id="2-5-删除文件"><a href="#2-5-删除文件" class="headerlink" title="2.5 删除文件"></a>2.5 删除文件</h4><p>从版本库中删除文件也需要执行两个步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git rm file</span><br><span class="line">$ git commit -m &quot;remove file&quot;</span><br></pre></td></tr></table></figure>
<p>如果删错了，可以从版本库中把误删的文件恢复到最新版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- file</span><br></pre></td></tr></table></figure>
<h3 id="三、远程仓库"><a href="#三、远程仓库" class="headerlink" title="三、远程仓库"></a>三、远程仓库</h3><p>Git是分布式版本控制系统，同一个Git仓库，可以分布到不同的机器上，实际情况往往是这样，找一台电脑充当服务器的角色，每天24小时开机，其他每个人都从这个“服务器”仓库克隆一份到自己的电脑上，并且各自把各自的提交推送到服务器仓库里，也从服务器仓库中拉取别人的提交，<strong>Github</strong> 应运而生，顾名思义，这个网站就是提供Git仓库托管服务的，所以，只要注册一个GitHub账号，就可以免费获得Git远程仓库。</p>
<p>由于本地 Git 仓库和 Github 仓库之间的传输是通过SSH加密的，所以需要按照以下步骤设置：</p>
<p><strong>第一步</strong>：创建 SSH Key，首先在用户主目录下查看有无 .ssh 目录，如果有，再看看这个目录下有无 id_rsa 和 id_rsa.pub 这两个文件，如果有了，可以直接进行下一步，如果没有，打开 Git Bash （Windows下），创建 SSH Key：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span><br></pre></td></tr></table></figure>
<p>把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可。</p>
<p>如果一切顺利的话，可以在用户主目录里找到 .ssh 目录，里面有 id_rsa 和 id_rsa.pub 两个文件，这两个就是SSH Key的秘钥对， id_rsa 是私钥，不能泄露出去， id_rsa.pub 是公钥。</p>
<p><strong>第二步</strong>：登陆GitHub，打开“Settings”，然后点击“SSH and GPG Keys”，点击“New SSH Key”，填上任意的 Title ，在 Key 文本框里粘贴 id_rsa.pub 的文件内容，最后点击 Add SSH key：</p>
<p><img src="E:/blog/learning/img/git_1.png" alt="实例1"></p>
<h4 id="3-1-添加远程库"><a href="#3-1-添加远程库" class="headerlink" title="3.1 添加远程库"></a>3.1 添加远程库</h4><p>本地创建了一个 Git 仓库后，又想在 GitHub 创建一个 Git 仓库，并且让这两个仓库进行远程同步，这样，GitHub上的仓库既可以作为备份，又可以让其他人通过该仓库来协作。</p>
<p><strong>第一步</strong>：登录 Github ，然后找到“Greate a new repository”，创建一个新的仓库：</p>
<p><img src="E:/blog/learning/img/git_2.png" alt="实例1"></p>
<p>Git 仓库生成后，我们根据 Github 的提示，在本地的 learngit 仓库下执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:gitname/learngit.git</span><br></pre></td></tr></table></figure>
<p>把上面的 gitname 替换成你自己的 Github 账户名，添加后，远程库的名字就是 origin ，这是 Git 默认的叫法，也可以改成别的。</p>
<p><strong>第二步</strong>：目前 Github 上的这个 learngit 远程库还是空的，把本地库的所有内容推送到远程库上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin master</span><br></pre></td></tr></table></figure>
<p>把本地库的内容推送到远程，用 git push 命令，实际上是把当前分支 master 推送到远程。</p>
<p>-u 参数表示，Git 不但会把本地的 master 分支内容推送的远程新的 master 分支，还会把本地的 master 分支和远程的 master 分支关联起来，在以后的推送或者拉取时就可以简化命令。</p>
<p>之后的本地修改提交操作，就可以通过如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<h4 id="3-2-从远程库克隆"><a href="#3-2-从远程库克隆" class="headerlink" title="3.2 从远程库克隆"></a>3.2 从远程库克隆</h4><p>现在，假设已经存在远程库 learngit ，下面通过以下命令从这个远程库克隆到本地库来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git@github.com:gitname/learngit.git</span><br></pre></td></tr></table></figure>
<p>上面的 gitname 替换成你自己的 Github 账户名，这里采用的 ssh 协议，也可以采用 https 等其他协议。</p>
<h3 id="四、分支管理"><a href="#四、分支管理" class="headerlink" title="四、分支管理"></a>四、分支管理</h3><p>可以创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，也不会影响别人工作。</p>
<h4 id="4-1-创建和合并分支"><a href="#4-1-创建和合并分支" class="headerlink" title="4.1 创建和合并分支"></a>4.1 创建和合并分支</h4><p>在版本回退里，每次提交，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即 <strong>master</strong> 分支。<strong>HEAD</strong> 严格来说不是指向提交，而是指向 master ，master 才是指向提交的，所以，HEAD 指向的就是当前分支。</p>
<p><strong>第一步</strong>：创建 dev 分支，并切换到 dev 分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b dev</span><br><span class="line">Switched to a new branch &apos;dev&apos;</span><br></pre></td></tr></table></figure>
<p><strong>git checkout</strong> 命令加上 -b 参数表示创建并切换，相当于以下两条命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch dev</span><br><span class="line">$ git checkout dev</span><br><span class="line">Switched to branch &apos;dev&apos;</span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong>：使用 <strong>git branch</strong> 命令查看当前分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br><span class="line">* dev</span><br><span class="line">  master</span><br></pre></td></tr></table></figure>
<p><strong>git branch</strong> 命令会列出所有分支，当前分支前面会标一个 * 号，然后我们可以在 dev 分支上正常提交。</p>
<p>当 dev 分支的工作完成，我们可以切回到 master 分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br></pre></td></tr></table></figure>
<p><strong>第三步</strong>：将 dev 分支的工作成果合并到 master 分支上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git merge dev</span><br></pre></td></tr></table></figure>
<p><strong>git merge</strong> 命令用于合并指定分支到当前分支。</p>
<p>合并完成后，可以删除 dev 分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d dev</span><br><span class="line">Deleted branch dev (was 023ddd6).</span><br></pre></td></tr></table></figure>
<h4 id="4-2-解决冲突"><a href="#4-2-解决冲突" class="headerlink" title="4.2 解决冲突"></a>4.2 解决冲突</h4><p>准备新的分支 feature ，修改 readme.txt 文件并提交，切换到 master 分支，再修改 readme.txt 文件并提交，这种情况下，Git无法执行“快速合并”，只能试图把各自的修改合并起来，这种合并就可能会造成冲突。必须手动解决冲突后再提交，<strong>git status</strong> 可以告诉我们发生冲突的文件，我们修改 readme.txt 文件后，再保存提交。</p>
<p>使用带参数的 <strong>git log</strong> 可以看到分支的合并情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --graph --pretty=oneline --abbrev-commit</span><br></pre></td></tr></table></figure>
<p>最后，删除 feature 分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d feature</span><br></pre></td></tr></table></figure>
<h4 id="4-3-分支管理策略"><a href="#4-3-分支管理策略" class="headerlink" title="4.3 分支管理策略"></a>4.3 分支管理策略</h4><p>通常，合并分支时，Git会用 <strong>Fast forward</strong> 模式，但这种模式下，删除分支后，会丢掉分支信息。</p>
<p>如果要强制禁用 Fast forward 模式，Git就会在 merge 时生成一个新的 commit ，这样，从分支历史上就可以看出分支信息。</p>
<p>禁用 <strong>Fast forward</strong> 下的分支合并如下（请注意 –no-ff 参数）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --no-ff -m &quot;merge with no-ff&quot; dev</span><br></pre></td></tr></table></figure>
<p>因为本次合并要创建一个新的 commit，所以加上 -m 参数，把 commit 的描述写进去。</p>
<p><strong>分支策略</strong></p>
<ul>
<li>master 分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活</li>
<li>干活都在 dev 分支上，也就是说，dev 分支是不稳定的，到某个时候，比如1.0版本发布时，再把 dev 分支合并到 master 上，在 master 分支发布1.0版本</li>
<li>每个人都在 dev 分支上干活，每个人都有自己的分支，时不时地往 dev 分支上合并就可以了</li>
</ul>
<h4 id="4-4-Bug分支"><a href="#4-4-Bug分支" class="headerlink" title="4.4 Bug分支"></a>4.4 Bug分支</h4><p>每个bug都可以通过一个新的临时分支来修复，修复后，合并分支，然后将临时分支删除。</p>
<p>当你接到一个修复一个代号101的 bug 的任务时，很自然地，你想创建一个分支 issue-101 来修复它，但是，当前正在 dev 上进行的工作还没法提交， 这里 Git 提供了一个 stash 功能，将当前工作“储藏”起来，等以后恢复现场后继续工作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash</span><br></pre></td></tr></table></figure>
<p>现在，用 git status 查看工作区，就是干净的（除了没有被Git管理的文件），因此可以放心地创建分支来修复 bug，然后在需要修复 bug 的分支上创建临时分支，这里是在 master 分支上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git checkout -b issue-101</span><br></pre></td></tr></table></figure>
<p>修复完成后，进行提交：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add readme.txt </span><br><span class="line">$ git commit -m &quot;fix bug 101&quot;</span><br></pre></td></tr></table></figure>
<p>然后切换到 master 分支，并完成合并，最后删除 issue-101 分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge --no-ff -m &quot;merged bug fix 101&quot; issue-101</span><br><span class="line">$ git branch -d issue-101</span><br></pre></td></tr></table></figure>
<p>现在回到 dev 分支上继续干活，并用 git stash list 命令查看之前的工作现场：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout dev</span><br><span class="line">$ git stash list</span><br></pre></td></tr></table></figure>
<p>然后进行工作现场的恢复，现在提供两种恢复方案：</p>
<ul>
<li><p>用 git stash apply 恢复，然后用 git stash drop 删除 stash的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git stash apply</span><br><span class="line">$ git stash drop</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接用 git stash pop 命令恢复，恢复的同时删除 stash 的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>你可以多次 stash ，恢复的时候，先用 git stash list 命令查看，然后恢复指定的stash：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash apply stash@&#123;0&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-Feature分支"><a href="#4-5-Feature分支" class="headerlink" title="4.5 Feature分支"></a>4.5 Feature分支</h4><p>每添加一个新功能，最好新建一个 feature-test 分支，在上面开发，完成后，合并，最后删除该 feature-test 分支。</p>
<p>首先，新建分支并切换到该分支，开发完成后提交：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b feature-test</span><br><span class="line">$ git add test.java</span><br><span class="line">$ git commit -m &quot;add feature test&quot;</span><br></pre></td></tr></table></figure>
<p>切回到 dev 分支并准备合并前，接到通知，功能取消，现在需要删除 feature-test 分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d feature-test</span><br><span class="line">error: The branch &apos;feature-test&apos; is not fully merged.</span><br><span class="line">If you are sure you want to delete it, run &apos;git branch -D feature-test&apos;.</span><br></pre></td></tr></table></figure>
<p>删除失败，并提示 feature-test 分支还没有被合并，如果删除，将丢失掉修改，如果需要强行删除，需要大写的 -D参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -D feature-test</span><br></pre></td></tr></table></figure>
<h4 id="4-6-多人协作"><a href="#4-6-多人协作" class="headerlink" title="4.6 多人协作"></a>4.6 多人协作</h4><p>当你从远程仓库克隆时，实际上Git自动把本地的 <strong>master</strong> 分支和远程的 <strong>master</strong> 分支对应起来了，并且远程仓库的默认名称是 <strong>origin</strong>。</p>
<p>要查看远程库的信息，用 <strong>git remote</strong> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git remote</span><br><span class="line">origin</span><br></pre></td></tr></table></figure>
<p>或者，用 <strong>git remote -v</strong> 显示更详细的信息。</p>
<h5 id="4-6-1-推送分支"><a href="#4-6-1-推送分支" class="headerlink" title="4.6.1 推送分支"></a>4.6.1 推送分支</h5><p>推送分支，就是把该分支上的所有本地提交推送到远程库，下面以 <strong>master</strong> 分支为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>并不是一定要把本地分支往远程推送，那么，哪些分支需要推送，哪些不需要呢？</p>
<ul>
<li><strong>master</strong> 分支是主分支，因此要时刻与远程同步</li>
<li><strong>dev</strong> 分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步</li>
<li><strong>bug</strong> 分支只用于在本地修复 <strong>bug</strong> ，就没必要推到远程了，除非老板要看看你每周到底修复了几个 bug</li>
<li><strong>feature</strong> 分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发</li>
</ul>
<h5 id="4-6-2-抓取分支"><a href="#4-6-2-抓取分支" class="headerlink" title="4.6.2 抓取分支"></a>4.6.2 抓取分支</h5><p>从远程库 <strong>clone</strong> 时，默认情况下只能看到本地的 <strong>master</strong> 分支，如果需要在 <strong>dev</strong> 分支上开发，就必须创建远程 <strong>origin</strong> 仓库的 <strong>dev</strong> 分支到本地，可以通过以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b dev origin/dev</span><br></pre></td></tr></table></figure>
<p>现在可以继续在 <strong>dev</strong> 分支上修改，然后把 <strong>dev</strong> 分支推送到远程的 <strong>dev</strong> 分支上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add readme.txt</span><br><span class="line">$ git commit -m &quot;add readme&quot;</span><br><span class="line">$ git push origin dev</span><br></pre></td></tr></table></figure>
<p>如果出现推送失败，因为你的小伙伴的最新提交和你试图推送的提交有冲突，解决办法也很简单，先用 <strong>git pull</strong> 把最新的提交从 <strong>origin/dev</strong> 抓下来，在本地合并，解决冲突，再推送。</p>
<p>第一次 <strong>git pull</strong> 之前需要指定本地的 <strong>dev</strong> 分支与远程的 <strong>origin/dev</strong> 分支的链接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch --set-upstream-to=origin/dev dev</span><br><span class="line">Branch &apos;dev&apos; set up to track remote branch &apos;dev&apos; from &apos;origin&apos;.</span><br></pre></td></tr></table></figure>
<p>然后 git pull ，但是远程 dev 分支与本地的 dev 分支合并发生冲突，需要自己手动解决冲突，解决后，提交并推送到远程库。</p>
<p>因此，多人协作的工作模式总结如下：</p>
<ol>
<li>首先，可以试图用 <strong>git push origin <branch-name></branch-name></strong> 推送自己的修改</li>
<li>如果推送失败，则因为远程分支比你的本地分支更新，要先用 <strong>git pull</strong> 试图合并</li>
<li>如果合并有冲突，则解决冲突，并在本地提交</li>
<li>没有冲突或者解决掉冲突后，再用 <strong>git push origin <branch-name></branch-name></strong> 推送就能成功</li>
</ol>
<p>如果 <strong>git pull</strong> 提示 <strong>no tracking information</strong>，则说明本地分支和远程分支的链接关系没有创建，用命令 <strong>git branch –set-upstream-to <branch-name> origin/<branch-name></branch-name></branch-name></strong> 。</p>
<h3 id="五、标签管理"><a href="#五、标签管理" class="headerlink" title="五、标签管理"></a>五、标签管理</h3><p>发布一个版本时，我们通常先在版本库中打一个标签 <strong>tag</strong> ，这样，就唯一确定了打标签时刻的版本。将来无论什么时候，取某个标签的版本，就是把那个打标签的时刻的历史版本取出来。所以，标签也是版本库的一个快照。</p>
<h4 id="5-1-创建标签"><a href="#5-1-创建标签" class="headerlink" title="5.1 创建标签"></a>5.1 创建标签</h4><p><strong>第一步</strong>：切换到需要打标签的分支上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br><span class="line">* dev</span><br><span class="line">  master</span><br><span class="line">$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong>：打一个新标签，并查看所有标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git tag v1.0</span><br><span class="line">$ git tag</span><br><span class="line">v1.0</span><br></pre></td></tr></table></figure>
<p>默认标签是打在最新提交的 commit 上的，有时候对历史的提交打标签，这时候怎么办？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline --abbrev-commit</span><br><span class="line">023ddd6 (HEAD -&gt; master) add distributed</span><br><span class="line">00cb738 wrote a readme file</span><br></pre></td></tr></table></figure>
<p>比方说这次要对 wrote a readme file 的提交打标签，它对应的 commit id 是 00cb738 ，键入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag v0.9 00cb738</span><br></pre></td></tr></table></figure>
<p>可以通过 <strong>git show</strong> 查看标签信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git show v0.9</span><br></pre></td></tr></table></figure>
<p>可以创建带有说明的标签，用 <strong>-a</strong> 指定标签名， <strong>-m</strong> 指定说明文字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v0.9 -m &quot;version 0.9 released&quot; 00cb738</span><br></pre></td></tr></table></figure>
<h4 id="5-2-操作标签"><a href="#5-2-操作标签" class="headerlink" title="5.2 操作标签"></a>5.2 操作标签</h4><h5 id="5-2-1-删除标签"><a href="#5-2-1-删除标签" class="headerlink" title="5.2.1 删除标签"></a>5.2.1 删除标签</h5><p>创建的标签都只存储在本地，不会自动推送到远程。所以，打错的标签可以在本地安全删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -d v0.1</span><br></pre></td></tr></table></figure>
<p>如果标签已经推送到远程，要删除远程标签就麻烦一点，先从本地删除后再从远程删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -d v0.9</span><br><span class="line">$ git push origin :refs/tags/v0.9</span><br></pre></td></tr></table></figure>
<h5 id="5-2-2-推送标签"><a href="#5-2-2-推送标签" class="headerlink" title="5.2.2 推送标签"></a>5.2.2 推送标签</h5><p>要推送某个标签到远程，使用命令 <strong>git push origin <tagname></tagname></strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin v1.0</span><br></pre></td></tr></table></figure>
<p>或者，一次性推送全部尚未推送到远程的本地标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --tags</span><br></pre></td></tr></table></figure>
  	
					
	  </div>     
	  

	
<div class="post-meta">
      
        <i class="iconfont icon-category"></i>       
        <a class="category-link" href="/categories/Git/">Git</a> 	
     
      	

      
        <i class="iconfont icon-tag"></i>     
          <a class="tag-link" href="/tags/分布式/">分布式</a> <a class="tag-link" href="/tags/协同开发/">协同开发</a> <a class="tag-link" href="/tags/版本控制/">版本控制</a>    
      	
</div>





<div class="post-footer">
  <div class="pf-left">
      <img class="pf-avatar" src="/images/header.jpg">
      <p class="pf-des">Hi,I am Lilac.</p>
  </div>

  <div class="pf-right">           
      <div class="pf-links">
        




<span class="donate-btn">
	<span class="iconfont icon-donate"></span>
</span>


<div id="donate-box" class="sildeUpMin">

	<span class="donate-cancel iconfont icon-cancel"></span>

	<div class="donate-img-box">
		<img id="donate-qr-wechat" class="noLazyLoad donate-img" src="/images/donate1.png" alt="No Donate Image!">	
		<img id="donate-qr-alipay" class="noLazyLoad donate-img" src="/images/donate2.jpg" alt="No Donate Image!">	
	</div>

	<span class="donate-word">世界很美，美在有你...</span>

	<div class="donate-list">
		<span class="iconfont icon-donate-wechat"></span>
		<span class="iconfont icon-donate-alipay"></span>
	</div>

</div>

 
        
	
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=21d601593a1de"></script>
	
	<span class="share-btn">
	<span class="iconfont icon-share"></span>
	</span>


	<div class="-mob-share sildeUpMin">
		   			             
            <a class="iconfont  icon-share-qq -mob-share-qq"></a>		
     	   			             
            <a class="iconfont  icon-share-weixin -mob-share-weixin"></a>		
     	   			             
            <a class="iconfont  icon-share-weibo -mob-share-weibo"></a>		
     	   			             
            <a class="iconfont  icon-share-douban -mob-share-douban"></a>		
     	   			             
            <a class="iconfont  icon-share-facebook -mob-share-facebook"></a>		
     	   			             
            <a class="iconfont  icon-share-twitter -mob-share-twitter"></a>		
     	   			             
            <a class="iconfont  icon-share-google -mob-share-google"></a>		
     	   
	</div>	

      </div>  
    <nav class="pf-paginator">
           
        
      
        
        <a href="/2019/01/18/Java并发之cas无锁/" data-hover="Java并发之cas无锁"> 下一篇</a>
            
  </nav>   
  </div>
</div> 
	


    <div id="comment">   
    </div>

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>

    <script>
        new Valine({
			el: '#comment',
			notify: false, 
			verify: false, 
			app_id: 'KdBEOrmsVTUkBB43Ijx5j25d-gzGzoHsz',
			app_key: 'jsKmKvo9W9vxprFRyfInIxRt',  
			path: window.location.pathname, 
			avatar: 'mm' ,
			guest_info: ['nick','mail'],
			placeholder: 'leave your footprints'
        });
    </script>
	
</article>

          </section> 
      </div>            
    
    <a id="backTop">
      <span>
        <i class="iconfont icon-backtotop"></i>
      </span>
    </a> 

  
    
    <div class="search-container sildeUpMin">
        <div class="search-header">
            <input type="text" placeholder="输入你想搜索的" id="search-input" class="search-input">  
            <span class="search-cancel iconfont icon-cancel"></span>
        </div>
        <div id="search-result" class="search-result"></div>
    </div>
 
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/favicon.png">   
      

         
            

            <a class="mobile-menu-link" href="/">首页
            </a>
            
         
            

            <a class="mobile-menu-link" href="/categories">分类
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">归档
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">标签
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">关于
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">搜索 </a>                 
            
         
      
</div>        
    


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?12f30a1c133ad3b622556efba282a5e6"; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>





     
    




<footer id="footer">	    

		
		<div class="footer-copyright">
		&copy;
				
		2018-
		
		2019		
	
		Lilac
		<br>

		Theme By
		<a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>	
		</div>			
	 
</footer>   

  

    <script src="/nayo.bundle.js"></script>           
  </body>        
</html>